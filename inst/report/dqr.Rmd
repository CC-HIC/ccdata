---
title: "NHIC Data Quality Report"
date: `r format(Sys.time(), "%d %B, %Y")`
output:
  pdf_document: 
    toc: true
    number_sections: true
    highlight: tango
  html_document:
    mathjax: local
    self_contained: no
    theme: journal
--- 

```{r, echo=FALSE, result="hide"}
# =================================> Setups
#load data
FILE <- '../data/delta_num.RData'
FILE <- paste(getwd(), FILE, sep="/")
library(ccdata)
if (!exists("ccd_delta_num"))
      load(FILE)
ccd <- ccd_delta_num
siteinfol <- site.info()
siteinfot <- as.data.frame(siteinfol, stringsAsFactors=FALSE)
row.names(siteinfot) <- c("Hospital", "Unit", "Location", "Notes")
siteinfot <- siteinfot[1:3, ] # remove notes
info <- extract.info(ccd)

suppressWarnings(library(pander))
panderOptions("digits", 2) 
panderOptions("table.split.table", Inf)

ctime <- file.info(FILE)$ctime
hostname <- system('hostname')
```

\newpage

# Data Summary
This is the data summary of file ``r FILE`` which sits on the machine 
``r Sys.info()['nodename']``, created at ``r ctime``.

## Site Code Information
```{r, echo=FALSE}
panderOptions("table.style", "multiline")
pander(t(siteinfot), split.table = Inf)
```
## XML files
```{r, echo=FALSE}
pander(file.summary.table(info))
```

## Data Summary of Sites
```{r pander, echo=FALSE}
pander(summary.table2(info))
```


# Identification Issues
## Non-identifiable Episodes 
```{r, echo=FALSE}
allmiss = info[nhs_number=="NULL" & pas_number=="NULL"]
numallmiss = nrow(allmiss)
```
Patient identity is based on NHS number or PAS number.  In this data extract,
there are **`r mdred(numallmiss)`** episodes missing both NHS number and PAS
number. The non-identifiable episodes are distributed as following, 

```{r, echo=FALSE}
pander(allmiss[,list("Number of Non-identifiable Episodes"=.N), by="Site"])
```
## Identification Missingness
```{r, echo=FALSE}
pander(id.missingness(info))
```

# Entire Field Missingness
\footnotesize
```{r, echo=FALSE}
pander(miss.fields(ccd))
```
